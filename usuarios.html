<!DOCTYPE html>
<html>
<head>
	<title>Página Web</title>
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<link rel="stylesheet" href="css/sweetalert.css">
		<link rel="stylesheet" href="css/font-awesome.css">
	<style type="text/css">
		.nigga {
			color: black;
		}
		.cursor {
			cursor: pointer;
		}
		.fundomodal{
			background-color: white;
		}
	</style>
	<script src="js/jquery-3.1.1.min.js" ></script>
	<!-- Latest compiled and minified JavaScript -->
	<script src="js/bootstrap.min.js" ></script>
	<script src="js/sweetalert.min.js" ></script>
	<script type="text/javascript" src="js/jquery.mask.min.js"></script>

	<script type="text/javascript" src="js/jsbn.js"></script>
	<script type="text/javascript" src="js/prng4.js"></script>
	<script type="text/javascript" src="js/rng.js"></script>
	<script type="text/javascript" src="js/rsa.js"></script>
	<script type="text/javascript" src="js/chave.js"></script>
	<meta charset="utf-8">
	<script type="text/javascript">
	// validação de usuário
	if(!localStorage.getItem("logado") || !localStorage.getItem("token")){
		window.location.href = 'index.html';
	}
	function loadMask(){
		var SPMaskBehavior = function (val) {
	      return val.replace(/\D/g, '').length === 11 ? '(00) 00000-0000' : '(00) 0000-00009';
	    },
	    spOptions = {
	      onKeyPress: function(val, e, field, options) {
	          field.mask(SPMaskBehavior.apply({}, arguments), options);
	        }
	    };

	    $('.sp_celphones').mask(SPMaskBehavior, spOptions);
	}
	function cadastrar(){
		$("#loginCadastro").empty("");
		$("#senhaCadastro").empty("");
		$('#modalCadastro').modal('show'); 
		 event.preventDefault();
	}
	function getUsuarios(){

		$("#usuario_id").empty("");
		 $.get( "https://chatrobot.com.br/crud/listUsuarios.php")
			  .done(function( data ) {
				$( data).each( function( index, data ) {
				   $('#tabela').append(
				   	'<tr> \
				   		<td>'+data.usuario_id+'</td> \
				   		<td>'+data.nome+'</td> \
				   		<td>'+data.telefone+'</td> \
				   		<td> \
				   			<i onclick=editar('+data.usuario_id+',"'+data.nome+'","'+data.telefone+'") class="fa fa-pencil-square-o fa-2x cursor" aria-hidden="true"> \
				   			</i>        <i class="fa fa-trash fa-2x cursor" onclick=remover('+data.usuario_id+',"'+data.nome+'") aria-hidden="true"></i> \
				   		</td> \
				   	</tr>');
				});	 
		   });

	}
	function editar(usuario_id,nome,telefone){
	
		$("#loginEditar").empty("");
		$("#senhaEditar").empty("");
		$("#telefoneEditar").empty("");

		console.log('Pediram pra eu editar o ' + usuario_id);
		$("#loginEditar").val(nome);
		$("#usuario_id").val(usuario_id);
		$("#senhaEditar").val("123456");
		loadMask();
		$("#telefoneEditar").val(telefone);
		
		$('#modalEditar').modal('show'); 
	}
	function remover(usuario_id,nome){
			swal({
			  title: "Quer mesmo remover o usuário "+nome+" ?",
			  text: "Não será possível recuperar este registro",
			  type: "warning",
			  showCancelButton: true,
			  closeOnConfirm: false,
			  confirmButtonText: "Sim, delete agora!",
  			  cancelButtonText: "Cancelar",
			  showLoaderOnConfirm: true,
			},
			function(){
			 $.post( "https://chatrobot.com.br/crud/RemoverUsuario.php", { usuario_id: encrypt(String(usuario_id)), token: encrypt(localStorage.getItem("token"))  })
			  .done(function( data ) {
			  		if(data.status == 'sucesso'){
								  
					    swal("O usuário "+nome+" foi removido.");
				
				  		$('#tabela').empty("");
				  		getUsuarios();
			  		}
		    	  });
			});

			


	}
	$(document).ready(function(){


		getUsuarios();

		$("#formularioEditar").submit(function(){
		   var login = $("#loginEditar").val();
		   var senha = $("#senhaEditar").val();
		   var telefone = $("#telefoneEditar").val();
		   var usuario_id = $("#usuario_id").val();
		   if(login == "" || senha == "" || telefone == ""){
		   	sweetAlert("Oops...", "PREENCHA DIREITINHO AMIGO!", "error");
		   	 event.preventDefault();
		   	return 0;
		   }

		   $.post( "https://chatrobot.com.br/crud/editUsuario.php", { login: encrypt(login), senha: encrypt(senha),  token: encrypt(localStorage.getItem("token")) , telefone: encrypt(telefone), usuario_id: encrypt(usuario_id)  } )
			  .done(function( data ) {
			  		if(data.status == 'sucesso'){
			  		swal({   title: "SUCESSO!",   text: "Você será redirecionado em 2,5 segundos.",   timer: 2500,   showConfirmButton: false });
			  		getUsuarios();
			  		$('#modalEditar').modal('hide');  
			  		$('#tabela').empty("");

			  		}
		   		});
	 		event.preventDefault();
		});
      
		$("#formularioCadastro").submit(function(){
		   var login = $("#loginCadastro").val();
		   var senha = $("#senhaCadastro").val();
		   var telefone = $("#telefoneCadastro").val();
		   var usuario_id = $("#usuario_id").val();
		   if(login == "" || senha == "" || telefone == ""){
		   	sweetAlert("Oops...", "PREENCHA DIREITINHO AMIGO!", "error");
		   	 event.preventDefault();
		   	return 0;
		   }
		  console.log({ login: encrypt(login), senha: encrypt(senha), token: encrypt(localStorage.getItem("token")) , telefone: encrypt(telefone)});
		   $.post( "https://chatrobot.com.br/crud/cadastrarUsuario.php", { login: encrypt(login), senha: encrypt(senha), token: encrypt(localStorage.getItem("token")) , telefone: encrypt(telefone)} )
			  .done(function( data ) {
			  		if(data.status == 'sucesso'){
			  		swal({   title: "SUCESSO!",   text: "Você será redirecionado em 2,5 segundos.",   timer: 2500,   showConfirmButton: false });
			  		getUsuarios();
			  		$('#modalCadastro').modal('hide');  
			  		$('#tabela').empty("");

			  		}
		   		});
	 		event.preventDefault();
		 });

	});
	</script>
	</head>
<body>
		<div class="container">	
				<div class="row">
					<div class="col-md-6 col-md-offset-2" >
					<a href="" class="btn btn-warning nigga" onclick="cadastrar()">Novo Usuário</a><br><br>

					<div class="table-responsive">
							<table  class="table table-hover table-striped table-bordered">

								<tr>
									<th>ID</th>
									<th>Nome</th>
									<th>Telefone</th>
									<th>Ação</th>
								</tr>
								<tbody id="tabela">
								</tbody>
							</table>
							</div>
					</div>
				</div>
		</div>	


<!-- Small modal -->
<!-- <button type="button" class="btn btn-primary" data-toggle="modal" data-target=".bs-example-modal-sm">Small modal</button> -->

<div id="modalEditar" class="modal fade bs-example-modal-md fundomodal" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel ">
  <div class="modal-dialog modal-md " role="document">
    <div class="modal-content ">
      <form id="formularioEditar" method="POST" >
		<div class="col-md-12">
			<div class="input-group">
				<h1>Editar Cadastro</h1>
			  <label>Login</label>
			  <input type="text" id="loginEditar" name="login" class="form-control" placeholder="Digite seu nome">
			</div>
			<div class="input-group">
			  <label>Senha</label>
			  <input type="password" id="senhaEditar" name="senha" class="form-control" value="123456" placeholder="Digite sua senha">
			</div><br>
			 <div class="input-group">
			  <label>Celular</label>
			  <input type="text" id="telefoneEditar" name="telefone" class="form-control sp_celphones" value="" placeholder="Digite seu telefone">
			</div><br>
			<input type="hidden" name="usuario_id" value="" id="usuario_id">
			<input type="submit" VALUE="Alterar" class="btn btn-primary">
		</div>
	</form>
    </div>
  </div>
</div>

<div id="modalCadastro" class="modal fade bs-example-modal-md fundomodal" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel ">
  <div class="modal-dialog modal-md " role="document">
    <div class="modal-content ">
      <form id="formularioCadastro" method="POST" >
		<div class="col-md-12">
			<h1>Cadastro</h1>
			<div class="input-group">
			  <label>Login</label>
			  <input type="text" id="loginCadastro" name="login" class="form-control" placeholder="Digite seu nome">
			</div><br>
			<div class="input-group">
			  <label>Senha</label>
			  <input type="password" id="senhaCadastro" name="senha" class="form-control" value="" placeholder="Digite sua senha">
			</div><br>
			<div class="input-group">
			  <label>Celular</label>
			  <input type="text" id="telefoneCadastro" name="telefone" class="form-control sp_celphones" value="" placeholder="Digite seu telefone">
			</div><br>

			<input type="submit" VALUE="Cadastrar" class="btn btn-primary">
		</div>
	</form>
    </div>
  </div>
</div>


</body>
</html>