<!DOCTYPE html>
<html>
<head>
	<title>Página Web</title>
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<link rel="stylesheet" href="css/sweetalert.css">

	<script src="js/jquery-3.1.1.min.js" ></script>
	<!-- Latest compiled and minified JavaScript -->
	<script src="js/bootstrap.min.js" ></script>
	<script src="js/sweetalert.min.js" ></script>
	<script type="text/javascript" src="js/jsbn.js"></script>
	<script type="text/javascript" src="js/prng4.js"></script>
	<script type="text/javascript" src="js/rng.js"></script>
	<script type="text/javascript" src="js/rsa.js"></script>
	<script type="text/javascript" src="js/chave.js"></script>

	<meta charset="utf-8">
	<script type="text/javascript">
	function checkClear(usuario_id,token){
	   $.post( "https://chatrobot.com.br/crud/checkClear.php", { usuario_id:  encrypt(usuario_id), token:  encrypt(token) })
		  .done(function( response ) {
		  		console.log(response);
		  		if(response.status == 'sucesso'){
		  		localStorage.setItem("logado", "true");
				localStorage.setItem("token", token);
				swal({
				  title: "A validação foi um sucesso!",
				  text: "Em instantes você será redirecionado.",
				  timer: 3000,
				  type: "success",
				  showConfirmButton: false
				});
		  			setTimeout(function(){
						window.location.href = 'usuarios.html';
		  			 }, 2500);
		  		} 

		  		});
	}
	$(document).ready(function(){


		$("form").submit(function(){
		   var login = $("#login").val()
		   var senha = $("#senha").val();
		   if(login == "" || senha == ""){
		   	sweetAlert("Oops...", "PREENCHA DIREITINHO AMIGO!", "error");
		   	 event.preventDefault();
		   	 return 0;
		   }
		   $.post( "https://chatrobot.com.br/crud/checkLogin.php", { login:  encrypt($("#login").val()), senha:  encrypt($("#senha").val()) })
			  .done(function( data ) {
			  	console.log(data);
			  		if(data.status == 'erro'){
			  			sweetAlert("Oops...", "USUÁRIO OU SENHA INVÁLIDOS!", "error");
		   	 			
			  		} else {
		
			  			swal({   title: "Verificação em 2 Etapas!",   text: "Envie seu contato para o nosso bot no telegram <a href='https://telegram.me/validatorbot' target='_new'>@validatorbot</a> para validar seu acesso",   timer: 99999,   showConfirmButton: false, html:true });
			  			event.preventDefault();
			  			var intervalo = window.setInterval(function() {
								checkClear(data.usuario_id,data.token);
						}, 1000);
			  			
			  		}
			   	   
		   });
			event.preventDefault();
		});
	});
	</script>
	</head>
<body>
		<div class="container">	
				<div class="row">
					<div class="col-md-6 col-md-offset-4" >
							<div class="col-md-12">
								<h3>Teste de Segurança</h3>
							</div>
							<form id="formulario" method="POST" >
								<div class="col-md-8">
									<div class="input-group">
									  <label>Login</label>
									  <input type="text" id="login" name="login" autocomplete="off" class="form-control" placeholder="Digite seu nome">
									</div>
									<div class="input-group">
									  <label>Senha</label>
									  <input type="password" id="senha" name="senha" class="form-control" placeholder="Digite sua senha">
									</div><br>
									<input type="submit" name="Entrar" class="btn btn-primary">
								</div>
							</form>
					</div>
				</div>
		</div>	
</body>
</html>